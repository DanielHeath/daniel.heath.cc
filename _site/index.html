<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8"/>
		<title> Home |  Sans Bytes</title>
		<link rel="stylesheet" href="/bootstrap/css/bootstrap.min.css" />
		<link rel="stylesheet" href="/bootstrap/css/bootstrap-responsive.min.css" />
		<link rel="stylesheet" href="/style.css" />
		<link rel="alternate" type="application/rss+xml" title="RSS Feed" href="/feed.xml" />
	</head>

	<body>
		<div class="row-fluid page-header">
			<header>
				<a href="/">
					<div class="span1">
						<img src="/profile-pic.png" class="heading-image" licence="http://creativecommons.org/licenses/by-nd/3.0/"/>
					</div>
					<div class="span4">
						<h1>Sans Bytes</h1>
						<span class="small">Daniel Heath blogs here</span>
					</div>
				</a>
			</header>
		</div>

	    <div class="row">
		<div class="span2">

			<ul class="nav nav-pills nav-stacked">
				<li class="nav-header">Projects</li>
				<li>
					<a href="/furious-earth">Furious Earth<br/> (two-player shooter)</a>
				</li>
				<li>
					<a href="http://wod.daniel.heath.cc" target="blank">Mage: the Awakening Character Creator<br/>(new window)</a>
				</li>
				<li class="nav-header">Posts</li>
			
				<li>
					<a href="/2014/08/27/postgres-features-in-20-minutes/">Postgres features for Ruby developers</a>
				</li>
			
				<li>
					<a href="/2013/10/03/questions-for-prospective-employers/">Questions for prospective employers</a>
				</li>
			
				<li>
					<a href="/2013/06/23/learning-go/">Learning Go</a>
				</li>
			
				<li>
					<a href="/2013/06/03/sprockets-and-go/">The rails asset pipeline - Now for every framework.</a>
				</li>
			
				<li>
					<a href="/2013/03/19/removing-cortiz-is-pointless/">Removing Carmen Ortiz is pointless</a>
				</li>
			
				<li>
					<a href="/2013/02/11/push-vs-pull/">Push vs Pull</a>
				</li>
			
				<li>
					<a href="/2013/02/10/static-sites-on-s3/">Thanks</a>
				</li>
			
				<li>
					<a href="/2013/02/09/distributed-teams/">Distributed Teams</a>
				</li>
			
				<li>
					<a href="/2011/08/22/fast-tests-with-phantomjs/">Fast tests with PhantomJS</a>
				</li>
			
				<li>
					<a href="/2011/08/21/testing-web-applications/">Testing web applications</a>
				</li>
			
				<li>
					<a href="/2011/08/20/practices-for-building-web-applications/">Practices for building web applications</a>
				</li>
			
				<li>
					<a href="/2011/08/19/tools-for-building-web-applications/">Tools for building web applications</a>
				</li>
			
			</ul>
		</div>

		<div class="span10">

				<div id="content">
					<!-- Show last 5 posts here -->


  
  <article class="post span8 offset1 h-entry">
  <h3>
  	<a class="p-name" href="/2014/08/27/postgres-features-in-20-minutes/">Postgres features for Ruby developers</a>
  	<div class="byline">
	  	<span
	  		class="small post-date dt-published"
	  		datetime="2014-08-27 00-00-00"
	  	>Aug 27, 2014</span>
	  	<span class="small p-author author-byline h-card">Daniel Heath</span>
  	</div>
  </h3>

  <div class="row">
    <div class="span6 content offset1 e-content">
      <h2 id="about-postgres">About postgres</h2>

<p>Postgres is a relational database which is
widely used by Ruby developers.</p>

<p>For instance, it’s the default database for Heroku (a popular
hosting provider for Ruby apps).</p>

<p>Like most databases, postgres uses standard SQL.
It also offers many features which
are not available in most other databases.</p>

<p>I’m going to provide a high-level overview of features
here without providing much detail.
If you have questions, the <a href="http://www.postgresql.org/docs/current/static/sql.html">online documentation for postgres</a> is
comprehensive, useful, and up to date.</p>

<h2 id="overview-of-features">Overview of Features</h2>

<h3 id="uuid-columns">UUID columns</h3>

<p>By default, Rails gives you tables with an integer ID.
This ID is always generated when you create a new
record - you can’t specify the value for a new records ID.</p>

<p>Postgres supports using a Universally Unique ID (UUID) instead.</p>

<p>UUIDs look like this: <code>93743318-67f4-4c29-8ba0-5ba4f667c7b2</code>.</p>

<p>This can be a useful alternative because it lets you specify
the ID, but will still generate an ID if you don’t specify one.</p>

<h3 id="text-search">Text Search</h3>

<p>Some apps need fulltext search, but running a separate search engine
is hard. Postgres has a reasonably good quality text-search engine built in.</p>

<p>You’ll need to spend some time perusing the documentation to use this - every
app is different and you’ll need to configure the search to suit your needs.</p>

<h3 id="spatial-data">Spatial data</h3>

<p>One of the most commonly used extensions to postgres is called PostGIS.
This lets you store geographic data (e.g. points or areas on a map).</p>

<p>You can then write queries to find (e.g.) what’s
within 10km of this point, with the closest points first.</p>

<h3 id="scaling">Scaling</h3>

<p>Most web applications using postgres will have one server
dedicated to running postgres, with other servers running
the web application.</p>

<p>As the amount of data you’re dealing with increases,
the database server can become overloaded.</p>

<p>There are three common approaches to avoiding this:</p>

<h4 id="throw-money-at-it">Throw money at it</h4>

<p>The easiest answer is usually “buy more ram/CPU/disk”.</p>

<h4 id="partitioning-via-child-tables">Partitioning via Child Tables</h4>

<p>Partitioning lets you use multiple servers, storing part of your data on each of them.</p>

<p>This technique helps you scale a database which is overloaded
due to too many <code>update</code>, <code>delete</code> &amp; <code>insert</code> commands.</p>

<p>For instance, all records where the <code>name</code> field starts from A through F
will go to one server, G through P to a second, and the remainder to a third.</p>

<p>You can achieve this using a feature called child tables (the documentation has good examples).</p>

<h4 id="replication">Replication</h4>

<p>Replication lets you use multiple servers, storing all of your data on each of them.
Only one of the servers is allowed to handle <code>update</code>, <code>insert</code> or <code>delete</code> queries.</p>

<p>This technique helps you scale a database which is overloaded
due to too many <code>select</code> queries running at once.</p>

<p>It is also good because each server has a full copy of the database,
meaning that if the primary database fails, you can
quickly switch to one of the replica servers.</p>

<p>Most modern databases, including Postgres, have good
support for replication.</p>

<h3 id="arrays-and-hashes-and-json-oh-my-xml-too">Arrays and Hashes and JSON, oh my! (XML too)</h3>

<h4 id="arrays">Arrays</h4>

<p>A column in an SQL table has a type (e.g. string, integer, timestamp).
Postgres also lets you can create a column which stores an array of
strings, or timestamps, or any other type (even arrays of arrays!).</p>

<p>If you’re using Rails with ActiveRecord, these arrays
work like normal Ruby arrays.</p>

<h4 id="hashes-via-hstore">Hashes (via HSTORE)</h4>

<p>Similarly to arrays, you can store hashes like <code>{'foo' =&gt; 'bar', 'k' =&gt; 'v'}</code>
This works like a normal Ruby hash through ActiveRecord, except you can
only use strings for the keys and values.</p>

<h4 id="json">JSON</h4>

<p>Postgres has a JSON type which can store any JSON value.
ActiveRecord makes this work nicely with Ruby (with caveats;
it can’t tell that the JSON has changed when
you modify part of a nested structure).</p>

<p>You can query your JSON data using postgres built-in functions.</p>

<h4 id="xml">XML</h4>

<p>The XML type will stop you from accidentally storing something which
is not valid XML. This is better than just using a string field, as
you can be sure that the data you have stored is valid XML.</p>

<p>You can query your XML data using XPATH selectors.</p>

<h3 id="stored-procedures">Stored procedures</h3>

<p>Postgres lets you create stored procedures (functions written in SQL).</p>

<p>You can write these functions in other languages if you have the right
extensions installed; for instance, the V8 Postgres extension lets you
write stored procedures in Javascript. There is also a Ruby extension.</p>

<p>Writing stored procedures in Javascript is clearly a good idea which
will not upset your teammates.</p>

<h3 id="indexing">Indexing</h3>

<p>Big database tables can be hundreds of gigabytes, and it can take a long
time to scan through all that data to find the record you’re looking for.</p>

<p>An index is a much smaller file which can be scanned quickly and tells
the database where to find the records which match a query.</p>

<p>Practically all databases support some kind of indexing.</p>

<h4 id="partial-indexes">Partial indexes</h4>

<p>Unlike other databases, postgres lets you create an index with a
<code>where</code> condition (e.g. <code>create index (...) where (condition)</code>).</p>

<p>This means that the index file can be even smaller and quicker to use.</p>

<h4 id="expression-indexes">Expression indexes</h4>

<p>Postgres also allows you to create an index on any expression (not just a column).
This means you can do things like <code>create index index_name on table_name ( to_uppercase(description) )</code></p>

<h3 id="ddl-transactions">DDL Transactions</h3>

<p>This feature protects you when running migrations.</p>

<p>In other databases, if a migration fails part-way through, the database
can be left half-way between the old state and the new state. Postgres
stops this from happening - migrations either succeed completely, or
do nothing at all.</p>

<h3 id="constraints--deferred-constraints">Constraints &amp; Deferred constraints</h3>

<p>Many databases support constraints (like validations built into the database).</p>

<p>However, they are often hard to use because they can’t be broken, even temporarily.</p>

<p>Postgres supports <code>deferred</code> constraints, which only apply when you commit a transaction.
This makes constraints far more usable with Rails.</p>

<h3 id="foreign-tables">Foreign Tables</h3>

<p>Foreign tables let you run join queries against tables which are in
a totally different database (e.g. MySql or any JDBC database).</p>

<p>Handy when dealing with really big, organically grown systems.</p>

    </div>
  </div>
</article>




  
  <article class="post span8 offset1 h-entry">
  <h3>
  	<a class="p-name" href="/2013/10/03/questions-for-prospective-employers/">Questions for prospective employers</a>
  	<div class="byline">
	  	<span
	  		class="small post-date dt-published"
	  		datetime="2013-10-03 00-00-00"
	  	>Oct  3, 2013</span>
	  	<span class="small p-author author-byline h-card">Daniel Heath</span>
  	</div>
  </h3>

  <div class="row">
    <div class="span6 content offset1 e-content">
      <p>I’ve been jobhunting a bit recently. Below are a few of the questions I find give me a reasonable sense of what a company is about.</p>

<h2 id="corporate">Corporate</h2>

<p>How many large customers? How many small ones? How much variance in customer spend is there? (companies with few large customers are probably going to work on whatever those customers tell them to work on; if they have many small customers and don’t  A/B test something might be wrong)</p>

<p>Org chart: How many sales / dev / product / UX / admin?</p>

<p>Has the team released any interesting OSS in the last year (on work time)?</p>

<p>Has the team released any interesting OSS in the last year (on their own time)?</p>

<p>How much pairing do you do and when/why do you do it?</p>

<p>How/when do you do code reviews? During pairing?</p>

<h2 id="code">Code</h2>

<p>What’s your take on test coverage?</p>

<p>What quality metrics do you use?</p>

<p>Do you enforce a styleguide? How?</p>

<p>What languages &amp; frameworks do you use?</p>

<p>How long does a typical CI build take?
How long does a typical local build take?</p>

<p>What techniques do you use to keep tests running fast? (e.g. parallel tests, GC tweaks, avoiding I/O)</p>

<p>How many code repositories? apps?</p>

<h2 id="devops">Devops</h2>
<p>How similar is your development environment to production?</p>

<p>How many architectural pieces are there (appworker, queue, cache, database)?</p>

<p>How many of these are outsourced vs self run (e.g. are you using RDS/heroku PG, or running mysql/postgres yourselves? Do you run your own queue or use iron.io?)</p>

<p>How often do you deploy? Continuous delivery? Fortnightly sprints?</p>

<p>How many production-like environments do you have (eg staging, uat)?</p>

<p>How long from ‘lets deploy’ to ‘done’?</p>

<p>How long to roll-back from a bad deploy?</p>

<p>How many servers are you running?</p>

<p>How many kinds of server are you running (db, cache, web, ci, SCM hosting…)?</p>

<p>Cloud or self-hosted (or something else)?</p>

<h2 id="team--culture">Team &amp; Culture</h2>

<p>How is the team organised? Small groups? Heirarchy? Triads?
How do the dev team decide what to work on?
How do you stay in sync across multiple locations (if applicable)?
How do the team keep each other informed (eg email/chat/face-to-face)?</p>

<p>How often do you use A/B testing to determine whether a change stays? Who makes the call on what to test?</p>

<p>How do you set up a new development environment?</p>


    </div>
  </div>
</article>




  
  <article class="post span8 offset1 h-entry">
  <h3>
  	<a class="p-name" href="/2013/06/23/learning-go/">Learning Go</a>
  	<div class="byline">
	  	<span
	  		class="small post-date dt-published"
	  		datetime="2013-06-23 00-00-00"
	  	>Jun 23, 2013</span>
	  	<span class="small p-author author-byline h-card">Daniel Heath</span>
  	</div>
  </h3>

  <div class="row">
    <div class="span6 content offset1 e-content">
      <p>I’ve been using Go fulltime for ~9 months now.</p>

<p>The big differences I’ve noticed coming from Ruby:</p>

<h2 id="imports">Imports</h2>

<p>Imports can’t clobber the global namespace or change the behavior of other packages (unless those packages were designed to allow it).</p>

<p>Only types/methods that are exported by a package are available when you import it.</p>

<h2 id="static-language">Static language</h2>
<p>There’s no monkey patching.
When writing packages, export interfaces, not types (to make testing possible).</p>

<h2 id="composition-not-inheritance">Composition, not inheritance</h2>
<p>Go has no classes. Group data together using structs.</p>

<p>Any type can have methods. E.G.</p>

 	type Foo string
 	func(f Foo) Print() { fmt.Println(f) }
 	Foo(“a string”).Print() # Prints “a string”

 	type Bar struct { str string }
 	func(b Bar) Print() { fmt.Println(b.str) }
 	Bar{“A different string”}.Print() # Prints “A different string”

<p>Important differences moving from ruby to go:
* Code re-use via composition feels very natural coming from ruby.
 * Where you would have used a module Foo in ruby, embed an interface Foo in go.</p>

<ul>
  <li>
    <p>Because imports can’t interfere with one another, many small dependencies is not a problem. Compose your app from many small frameworks rather than using one large one.</p>
  </li>
  <li>
    <p>Monitoring is back in the dark ages (No newrelic). Plan accordingly.</p>
  </li>
</ul>

    </div>
  </div>
</article>




  
  <article class="post span8 offset1 h-entry">
  <h3>
  	<a class="p-name" href="/2013/06/03/sprockets-and-go/">The rails asset pipeline - Now for every framework.</a>
  	<div class="byline">
	  	<span
	  		class="small post-date dt-published"
	  		datetime="2013-06-03 00-00-00"
	  	>Jun  3, 2013</span>
	  	<span class="small p-author author-byline h-card">Daniel Heath</span>
  	</div>
  </h3>

  <div class="row">
    <div class="span6 content offset1 e-content">
      <p>I recently found myself wanting the features of the rails asset pipeline in my golang project at work.</p>

<p>Since there isn’t much in the way of asset pipelining for golang yet, I built it.</p>

<p>Turns out, sprockets is really easy to integrate.</p>

<h2 id="assets-in-development">Assets in development</h2>
<p>First things first - lets get to ‘it works on my machine’.</p>

<p>I’ve put together a <a href="https://github.com/DanielHeath/sprockets-sample">sample repo</a> using the asset pipeline.</p>

<p>The setup for your app will be similar:
 * The <code>assets</code> folder contains your stylesheets, javascript, etc (this directory name is set in sprockets/environment.rb).
 * You’ll need a similar <code>Rakefile</code> to build assets (and maybe launch the server)
 * You might store the <code>sprockets</code> directory somewhere else - update the <code>Rakefile</code> to match.
 * Use a Gemfile and the bundler rubygem to manage dependencies.
 * Edit the rakefile to change the port the asset server runs on.</p>

<p>When your app starts (in development), it should make a request to <code>http://localhost:11111/assets/manifest.json</code>.</p>

<p>Parse this JSON hash; the keys are asset names (eg “application.css”) and the values are relative URLs the compiled assets can be fetched from.</p>

<p>When generating a link to an asset in your app, use the JSON hash you fetched to lookup the URL. In the case of “application.css” this might look like <code>http://localhost:11111/application-8e5bf6909b33895a72899ee43f5a9d53.css</code>.</p>

<p>That should be all you need for development - you should be able to see SASS/Coffeescript assets compiled and loading normally.</p>

<h2 id="assets-in-production">Assets in production</h2>
<p>For production we want to pre-compile assets rather than regenerating them each time they change.</p>

<p><code>rake assets</code> will create a ‘public’ folder containing ‘manifest.json’ (same format as before).
Get this directory onto your production servers (<code>git add -Af public/</code> will add it to source control if you deploy via git).</p>

<p>When generating a link to an asset, look up manifest.json (the same as in development, but from the filesystem instead of over HTTP).</p>

<h2 id="fin">Fin</h2>

<p>The whole thing, including deployment, took me well under a day to add to our app.
The resulting assets are minified, concatenated, and gzipped (for size).
They are also fingerprinted (so you can set an unlimited cache lifetime).</p>

    </div>
  </div>
</article>




  
  <article class="post span8 offset1 h-entry">
  <h3>
  	<a class="p-name" href="/2013/03/19/removing-cortiz-is-pointless/">Removing Carmen Ortiz is pointless</a>
  	<div class="byline">
	  	<span
	  		class="small post-date dt-published"
	  		datetime="2013-03-19 00-00-00"
	  	>Mar 19, 2013</span>
	  	<span class="small p-author author-byline h-card">Daniel Heath</span>
  	</div>
  </h3>

  <div class="row">
    <div class="span6 content offset1 e-content">
      <p>There have been a few petitions to remove Carmen Ortiz (U.S. Attorney), Stephen Heymann &amp; Scott Garland (assistant us attorneys) from office.</p>

<p>It’s natural to want the wrongdoer to be punished when their behavior causes something as awful as Aarons death.
It’s also unhelpful, and a waste of energy that could be directed towards preventing future cases like this.</p>

<p>Ortiz, Heymann and Garland reacted the same way you or I would.
This is a controversial position because few people like the idea that they could become that kind of amoral scoundrel.
However, almost all human beings derive their sense of right and wrong from those around them.</p>

<p>The US attorneys office promotes those who successfully prosecute high-profile cases. 
That is the metric by which success is judged, and Ortiz (and other US attorneys) have adjusted their behavior to optimize for this.</p>

<p>As long as prosecutorial overreach results in promotions (and is only infrequently punished, however severely) we are going to keep seeing US attorneys behaving like this.</p>

<p>The solution isn’t to fire more attorneys.</p>

<p>So here’s my question: 
What criteria for promotion within the US Attorneys office would result in genuine criminals being chased (instead of ‘people who have upset the government’)?</p>

    </div>
  </div>
</article>




				</div>
			</div>
	    </div>

		<footer class="row-fluid page-footer vcard">
			&copy; 2013
			<strong class="name fn">Daniel Heath</strong> |
			<a href="/about">About</a> |

			<address class="adr">
			    <a class="email" href="mailto:daniel@heath.cc">Email</a> |
			    <a href="http://daniel.heath.cc/">Blog</a> |
			    <a href="https://github.com/DanielHeath">Github</a> |
			    <a href="https://twitter.com/DanielrHeath">Twitter</a> |
			    <a href="/resume">Resume</a> |
			    <a href="https://plus.google.com/114859106574535166251">Google+</a> |
				<a class="url" href="xmpp:daniel@heath.cc">Jabber</a>

			</address>
		</footer>

		<script type="text/javascript">

		    var _gaq = _gaq || [];
		    _gaq.push(['_setAccount', 'UA-38426219-1']);
		    _gaq.push(['_setDomainName', 'heath.cc']);
		    _gaq.push(['_trackPageview']);

		    (function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		    })();

		</script>

	</body>

</html>
