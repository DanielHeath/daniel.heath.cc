<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8"/>
		<title> Home |  Sans Bytes</title>
		<link rel="stylesheet" href="/styles.css" />
		<link rel="alternate" type="application/rss+xml" title="RSS Feed" href="/feed.xml" />

		
			<meta property="og:title" content="Home" />
		

		<meta
			property="og:type"
			content="article"
		/>
	</head>

	<body>
		<header>
			<a class="home-link" href="/">
				<div
					class="heading-image"
					aria-label="Picture of author"
				></div>
				<div class="header-text">
					<h1>Sans Bytes</h1>
					<span class="small">Daniel Heath blogs here</span>
				</div>
			</a>
		</header>

		<nav>
			<details>
				<summary>Navigation</summary>
				<a href="/">
					Home
				</a>
				<details>
					<summary >Projects</summary>
					<a href="http://darkblade.herokuapp.com/characters/new">
						Mage: the Awakening Character Creator
					</a>
					<a href="/furious-earth">
						Furious Earth (a two-player space-shooter in vanilla JS)
					</a>
				</details>

				<details>
					<summary>Recent Posts</summary>
					
						<a href="/2018/07/02/css-modules-with-webpacker/">CSS Modules in Rails with Webpacker</a>
					
						<a href="/2017/11/27/rust-an-experience-report/">Rust: An experience report</a>
					
						<a href="/2016/12/10/browser-automation-the-hard-way/">Learn browser automation from scratch</a>
					
						<a href="/2014/08/27/postgres-features-in-20-minutes/">Postgres features for Ruby developers</a>
					
				</details>
				<details>
					<summary>Older posts</summary>
					
						<a href="/2013/10/03/questions-for-prospective-employers/">Questions for prospective employers</a>
					
						<a href="/2013/06/23/learning-go/">Learning Go</a>
					
						<a href="/2013/06/03/sprockets-and-go/">The rails asset pipeline - Now for every framework.</a>
					
						<a href="/2013/03/19/removing-cortiz-is-pointless/">Removing Carmen Ortiz is pointless</a>
					
						<a href="/2013/02/11/push-vs-pull/">Push vs Pull</a>
					
						<a href="/2013/02/10/static-sites-on-s3/">Thanks</a>
					
						<a href="/2013/02/09/distributed-teams/">Distributed Teams</a>
					
						<a href="/2011/08/22/fast-tests-with-phantomjs/">Fast tests with PhantomJS</a>
					
						<a href="/2011/08/21/testing-web-applications/">Testing web applications</a>
					
						<a href="/2011/08/20/practices-for-building-web-applications/">Practices for building web applications</a>
					
						<a href="/2011/08/19/tools-for-building-web-applications/">Tools for building web applications</a>
					
				</details>
			</details>

		</nav>

		<!-- Show last 5 posts here -->


  
  <article class="post h-entry">
	<h1>
		<a class="p-name" href="/2018/07/02/css-modules-with-webpacker/">CSS Modules in Rails with Webpacker</a>
		<div class="byline">
			<span
				class="small post-date dt-published"
				datetime="2018-07-02 00-00-00"
			>Jul  2, 2018</span>
			<span class="small p-author author-byline h-card">Daniel Heath</span>
		</div>
	</h1>

	<div class="content e-content">
		<h2 id="css-modules">CSS Modules?</h2>

<p>CSS Modules lets you write CSS with predictable local scope.</p>

<p>This avoids the need for (eg) manually following a naming convention to prevent accidental conflicts.</p>

<h2 id="alright-how-do-i-do-it">Alright, how do I do it?</h2>

<h3 id="install-webpacker">Install webpacker</h3>

<p>First, your app will need the <code class="highlighter-rouge">webpacker</code> gem installed &amp; configured (new rails apps come with it).</p>

<p>Add <code class="highlighter-rouge">javascript_pack_tag</code> and <code class="highlighter-rouge">stylesheet_pack_tag</code> to your layout per the webpacker setup instructions.</p>

<h3 id="setup-css-modules-for-webpack">Setup CSS modules for webpack</h3>

<p>There are two webpack implementations of CSS modules (css-loader and postcss-modules).</p>

<p>Webpacker uses postcss by default, so I’ve used postcss-modules (<code class="highlighter-rouge">yarn add postcss-modules</code>).</p>

<p>Having installed postcss-modules and autoprefier using <code class="highlighter-rouge">yarn</code>, lets configure webpacker to use them.
My projects <code class="highlighter-rouge">.postcssrc.yml</code> looks like this:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>plugins:
  postcss-import: {}
  postcss-cssnext: {}
  postcss-modules:
    generateScopedName: '[name]__[local]___[hash:base64:5]'
    modules: true
</code></pre></div></div>

<h3 id="add-some-css">Add some CSS</h3>

<p>Next, lets put some CSS where webpack will find it:</p>

<p>First, write your CSS in <code class="highlighter-rouge">app/javascript/src/my-module.css</code>.</p>

<p>Then, in <code class="highlighter-rouge">app/javascript/packs/application.js</code>, add <code class="highlighter-rouge">import myModule from '../src/my-module.css';</code> (at the start)</p>

<p>After you load a page in development, or run <code class="highlighter-rouge">rake assets:precompile</code>, you should see a new file appear: <code class="highlighter-rouge">app/javascript/src/my-module.css.json</code>.
This file describes how your CSS has been transformed.</p>

<h3 id="reference-your-css-from-rails-views">Reference your CSS from rails views</h3>

<p>I’ve written a helper to read these files.</p>

<p>In my project it’s at <code class="highlighter-rouge">app/helpers/css_modules_helper.rb</code> and contains the following code:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>module CssModulesHelper

  mattr_accessor :cache
  self.cache ||= {}

  def cssmodule(path)
    cache = {}
    if Rails.application.config.action_controller.perform_caching
      # Avoid reloading CSS paths
      cache = CssmodulesHelper.cache
    end

    return cache[path] if cache.include?(path)

    mod = JSON.parse(File.read Rails.root.join('app', 'javascript', 'src', path + '.json').to_s)

    # Let people use dashes in CSS and underscores in ruby
    mod.keys.each { |k| mod[k.underscore] = mod[k] }

    os = OpenStruct.new(mod)

    def os.call(*args)
      args.map do |arg|
        case arg
        when Hash
          arg.keys.select {|k| arg[k]}.map {|k| public_send(k) }
        else
          public_send arg
        end
      end.compact.flatten.join(" ")
    end

    cache[path] = os

    yield os
  end

end

</code></pre></div></div>

<p>Finally, we can reference our CSS from a view:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;% cssmodule "my-module.css" do |css| %&gt;
  &lt;!-- Dashes are turned into underscores, so .my-box becomes my_box --&gt;
  &lt;div
    class="&lt;%= css.my_box %&gt;"
  &gt;
    a box
  &lt;/div&gt;

  &lt;!-- The helper also offers multiple &amp; conditional class names (like the classnames JS lib) --&gt;
  &lt;div
    class="&lt;%= css.(:my_box, my_class: (Random.rand &gt; 0.5)) %&gt;"
  &gt;
    conditional class
  &lt;/div&gt;
&lt;% end %&gt;
</code></pre></div></div>

<p>You should see your styles applying now.</p>


	</div>
</article>




  
  <article class="post h-entry">
	<h1>
		<a class="p-name" href="/2017/11/27/rust-an-experience-report/">Rust: An experience report</a>
		<div class="byline">
			<span
				class="small post-date dt-published"
				datetime="2017-11-27 00-00-00"
			>Nov 27, 2017</span>
			<span class="small p-author author-byline h-card">Daniel Heath</span>
		</div>
	</h1>

	<div class="content e-content">
		<h1 id="learning-rust-an-experience-report">Learning rust: an experience report</h1>

<h2 id="installing">Installing</h2>

<p>Installing the latest version of rust via <code class="highlighter-rouge">brew</code> worked correctly first time.</p>

<h2 id="finding-a-tutorial">Finding a tutorial</h2>

<p>Searched for “getting started with rust”.</p>

<ul>
  <li><a href="https://doc.rust-lang.org/book/first-edition/getting-started.html">Google for ‘getting started rust’</a></li>
  <li><a href="https://doc.rust-lang.org/book/getting-started.html">DuckDuckGo for ‘getting started rust’</a></li>
</ul>

<p>Google found the first edition of the tutorial.
DuckDuckGo found the tutorial landing page, which suggested I used the second edition but anyone on google would’ve been unaware it existed.</p>

<p>I used <a href="https://doc.rust-lang.org/book/second-edition/">the second edition</a>.</p>

<h2 id="using-the-tutorial">Using the tutorial</h2>

<p>The tutorial suggested using rustup to install, using <code class="highlighter-rouge">curl | sh</code>.
I decide it’s probably safe to ignore that advice and use the version from my package manager (<code class="highlighter-rouge">rustc 1.21.0</code>).</p>

<p>The first example (hello world) works fine.
The second example (guessing game) doesn’t compile.
The error linked me to issue #27703.</p>

<p>I manage to figure out that rust issues are tracked on github (the error just has an issue number), and find that issue.
It’s clearly related, but tells me nothing I can use to get my code compiling.</p>

<p>A bit of searching turns up <a href="https://stackoverflow.com/questions/19671845/how-can-i-generate-a-random-number-within-a-range-in-rust#19674981">a stackoverflow question on the topic</a>;
the top answer is outdated, but a comment tells me
to check a different answer, which tells me to
use <code class="highlighter-rouge">extern crate rand;</code> and add dependencies to cargo.toml.</p>

<p>After reading up how to add dependencies to cargo.toml, I update the file and try again.
Cargo spends twenty-four minutes ‘updating registry’ (I want one small dependency and have specified the exact version!). My connection is slow, but it’s not <em>that</em> slow.
Activity monitor confirms it’s downloading at 20kb/s - everything else is fine).
Perhaps it would help if the default registry were installed at the same time as cargo?</p>

<p>Now the guessing game example runs - great!
I test out the example and it works.
In doing so, I (incidentally) notice that backtraces don’t have line numbers (!). Close enough for now - I’ll have another look next week or something.</p>


	</div>
</article>




  
  <article class="post h-entry">
	<h1>
		<a class="p-name" href="/2016/12/10/browser-automation-the-hard-way/">Learn browser automation from scratch</a>
		<div class="byline">
			<span
				class="small post-date dt-published"
				datetime="2016-12-10 00-00-00"
			>Dec 10, 2016</span>
			<span class="small p-author author-byline h-card">Daniel Heath</span>
		</div>
	</h1>

	<div class="content e-content">
		<h1 id="browser-automation-with-selenium-webdriver">Browser automation with selenium-webdriver</h1>

<h2 id="why">Why?</h2>

<p>Browser tests are super useful, but they’re famous for having hard to debug, unreliable failures.</p>

<p>This reputation is largely the result of developers learning high-level frameworks without understanding the underlying abstractions.</p>

<p>In this guide I’ll show you some cool terminal tricks - including how to drive a browser directly.</p>

<p>I wouldn’t write my tests for a production app this way, but it illustrates the underlying concepts in a way most tools abstract away.</p>

<p>This will help you to develop a better understanding of how most web testing tools work.</p>

<h2 id="setup">Setup</h2>

<p>You will need:</p>

<ul>
  <li>Java</li>
  <li>Google chrome</li>
  <li>A base64 decoder (preinstalled on mac) to get screenshots</li>
  <li>A terminal (preinstalled on linux/mac)</li>
  <li>curl (installed on most linux/mac )</li>
  <li><a href="https://stedolan.github.io/jq/download/">jq</a> to extract fields from JSON documents</li>
  <li><a href="http://www.seleniumhq.org/download/">selenium-server-standalone.jar</a> selenium-webdriver (not the same as selenium-rc - referred to as ‘selenium’ below)</li>
  <li><a href="https://sites.google.com/a/chromium.org/chromedriver/">chromedriver</a></li>
</ul>

<p>If you are using homebrew on mac, you can install the last three that way:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>brew <span class="nb">install </span>selenium-server-standalone
brew <span class="nb">install </span>jq
brew <span class="nb">install </span>chromedriver
</code></pre></div></div>

<h2 id="getting-started">Getting started</h2>

<p>selenium is the predominant way of writing automatinc browser tests. It can operate all major browsers.</p>

<p>Selenium runs on a client/server model with the following components:</p>

<ul>
  <li>Some website(s)</li>
  <li>A browser (chrome, in this example)</li>
  <li>Selenium-server (to open and control the browser)</li>
  <li>Your custom browser automation code (I’ll help you write some in this post)</li>
</ul>

<p>Open a terminal and run the standalone server:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># On OSX using homebrew:</span>
/usr/local/bin/selenium-server <span class="nt">-port</span> 4444

<span class="c"># Everyone else - you'll need to be in the directory where selenium is downloaded to / installed:</span>
java <span class="nt">-jar</span> selenium-server-standalone-3.0.1.jar <span class="nt">-port</span> 4444
</code></pre></div></div>

<p>Leave this running and open a another terminal window.
In the new window, run the following to ask the server to start a new chrome session
(copy &amp; paste will work, or save it to a file and run <code class="highlighter-rouge">source &lt;file&gt;</code>):</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="sb">`</span><span class="c"># Save the URL to the local selenium server`</span>
<span class="sb">`</span><span class="c"># to the variable SELENIUM_URL`</span>
<span class="nv">SELENIUM_URL</span><span class="o">=</span><span class="s2">"http://localhost:4444/wd/hub/session"</span>

<span class="sb">`</span><span class="c"># Save the result of asking for a new browser session`</span>
<span class="sb">`</span><span class="c"># to the variable SELENIUM_SESSION_ID`</span>
<span class="nv">SELENIUM_SESSION_ID</span><span class="o">=</span><span class="k">$(</span> <span class="se">\</span>
  <span class="sb">`</span><span class="c"># Use curl to make a HTTP POST asking the selenium` \</span>
  <span class="sb">`</span><span class="c"># server to open chrome` \</span>
  curl <span class="s2">"</span><span class="nv">$SELENIUM_URL</span><span class="s2">"</span> <span class="se">\</span>
       <span class="nt">--data-ascii</span> <span class="se">\</span>
       <span class="s1">'{"desiredCapabilities":{"browserName":"chrome"}}'</span> <span class="se">\</span>
       | jq <span class="nt">-r</span> .sessionId <span class="se">\</span>
<span class="k">)</span>
</code></pre></div></div>

<p>You should see a new window running chrome, looking at a blank page.</p>

<p>The above command sets your current shell (terminal window) up
with the variables <code class="highlighter-rouge">SELENIUM_SESSION_ID</code> and <code class="highlighter-rouge">SELENIUM_ID</code>,
which are used in later commands.</p>

<p>If you open a new shell, those variables will not be present
and the commands won’t work.</p>

<h2 id="navigating">Navigating</h2>

<p>Lets make our browser go to google.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="s2">"</span><span class="nv">$SELENIUM_URL</span><span class="s2">/</span><span class="nv">$SELENIUM_SESSION_ID</span><span class="s2">/url"</span> <span class="se">\</span>
     <span class="nt">--data-ascii</span> <span class="se">\</span>
     <span class="s1">'{"url": "https://google.com"}'</span> <span class="se">\</span>
     | jq <span class="nb">.</span>
</code></pre></div></div>

<p>You should see:</p>

<ul>
  <li>A page of JSON, including <code class="highlighter-rouge">{"state": "success"}</code></li>
  <li>The chrome window is now on google.com.</li>
</ul>

<h2 id="filling-in-forms">Filling in forms</h2>

<p>Lets automate issuing a search.
First, find the input element:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">SEARCH_BOX_ELEMENT</span><span class="o">=</span><span class="k">$(</span>
  curl <span class="s2">"</span><span class="nv">$SELENIUM_URL</span><span class="s2">/</span><span class="nv">$SELENIUM_SESSION_ID</span><span class="s2">/element"</span> <span class="se">\</span>
       <span class="nt">--data-ascii</span> <span class="se">\</span>
       <span class="s1">'{"using": "css selector", "value": "input[name=q]"}'</span> <span class="se">\</span>
       <span class="sb">`</span><span class="c"># Use 'jq' to extract part of the response. ` \</span>
       <span class="sb">`</span><span class="c"># -r to get the text without quotes. ` \</span>
       | jq <span class="nt">-r</span> .value.ELEMENT <span class="se">\</span>
<span class="k">)</span>
</code></pre></div></div>

<p>Now we’ll type something into the search box:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="s2">"</span><span class="nv">$SELENIUM_URL</span><span class="s2">/</span><span class="nv">$SELENIUM_SESSION_ID</span><span class="s2">/element/</span><span class="nv">$SEARCH_BOX_ELEMENT</span><span class="s2">/value"</span> <span class="se">\</span>
     <span class="nt">--data-ascii</span> <span class="se">\</span>
     <span class="s1">'{"value": ["s","e","l","e","n","i","u","m", "\n"]}'</span> <span class="se">\</span>
     | jq <span class="nb">.</span>
</code></pre></div></div>

<p>Switching to the chrome window, you should be able to see the search results.</p>

<h2 id="customizing-your-shell">Customizing your shell</h2>

<p>This is getting repetitive. Lets define some bash functions to make it easier:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function </span>debug <span class="o">{</span>
  <span class="k">if</span> <span class="o">[</span> <span class="nt">-n</span> <span class="s2">"</span><span class="nv">$DEBUG</span><span class="s2">"</span> <span class="o">]</span> <span class="p">;</span> <span class="k">then</span>
    <span class="c"># Print debug messages to STDERR</span>
    <span class="nb">echo</span> <span class="s2">"</span><span class="nv">$@</span><span class="s2">"</span> 1&gt;&amp;2
  <span class="k">fi</span>
<span class="o">}</span>

<span class="k">function </span>get <span class="o">{</span>
  <span class="c"># Build the URL, requiring that a path was provided</span>
  <span class="nb">local </span><span class="nv">URL</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">SELENIUM_URL</span><span class="k">}</span><span class="s2">/</span><span class="k">${</span><span class="nv">SELENIUM_SESSION_ID</span><span class="k">}${</span><span class="nv">1</span><span class="p">?Must provide URL</span><span class="k">}</span><span class="s2">"</span>

  debug <span class="s2">"</span><span class="nv">$URL</span><span class="s2">"</span>

  <span class="c"># Fetch the URL and format with jq.</span>
  curl <span class="nt">--silent</span> <span class="s2">"</span><span class="k">${</span><span class="nv">URL</span><span class="k">}</span><span class="s2">"</span> | jq <span class="nb">.</span>
<span class="o">}</span>

<span class="k">function </span>post <span class="o">{</span>
  <span class="c"># Build the URL, requiring that a path was provided</span>
  <span class="nb">local </span><span class="nv">URL</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">SELENIUM_URL</span><span class="k">}</span><span class="s2">/</span><span class="k">${</span><span class="nv">SELENIUM_SESSION_ID</span><span class="k">}${</span><span class="nv">1</span><span class="p">?Must provide URL</span><span class="k">}</span><span class="s2">"</span>

  <span class="c"># Set a default value for the POST data</span>
  <span class="nb">local </span><span class="nv">DATA</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">2</span><span class="p">-{\</span><span class="k">}</span><span class="s2">}"</span>

  <span class="c"># Validate that the provided data is valid JSON</span>
  <span class="nb">echo</span> <span class="s2">"</span><span class="nv">$DATA</span><span class="s2">"</span> | jq <span class="nb">.</span> <span class="o">&gt;</span> /dev/null <span class="o">||</span> <span class="se">\</span>
    <span class="k">${</span><span class="nv">ALLOW_INVALID_JSON</span><span class="p">?Second argument is not valid JSON</span><span class="k">}</span>

  debug <span class="s2">"</span><span class="nv">$URL</span><span class="s2">"</span>

  <span class="c"># Fetch the URL and format the response with jq.</span>
  curl <span class="nt">--silent</span> <span class="s2">"</span><span class="k">${</span><span class="nv">URL</span><span class="k">}</span><span class="s2">"</span> <span class="nt">--data-ascii</span> <span class="s2">"</span><span class="k">${</span><span class="nv">DATA</span><span class="k">}</span><span class="s2">"</span> | jq <span class="nb">.</span>
</code></pre></div></div>

<h2 id="screenshots">Screenshots</h2>

<p>Lets use these new functions to take a screenshot:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>get /screenshot <span class="sb">`</span><span class="c"># Ask for a screenshot` \</span>
    | jq <span class="nt">-r</span> .value <span class="sb">`</span><span class="c"># Fetch the raw (-r) string from the 'value'` \</span>
    | <span class="nb">base64</span> <span class="nt">-D</span> <span class="sb">`</span><span class="c"># Decode the base64-encoded data provided by selenium` \</span>
    <span class="o">&gt;</span> screenshot.png <span class="sb">`</span><span class="c"># Save the result to screenshot.png`</span>
</code></pre></div></div>

<p>If you open ‘screenshot.png’ you should see the page screenshotted.</p>

<h2 id="extracting-text-from-the-page">Extracting text from the page</h2>

<p>Lets grab the URL of each search result.</p>

<p>Looking at the document using ‘inspect element’, I can see that
search result URLs are all in <code class="highlighter-rouge">cite</code> elements and nothing else is.
That sounds like a good way to identify those URLs.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for </span>element_id <span class="k">in</span> <span class="k">$(</span> <span class="se">\</span>
  post /elements <span class="se">\</span>
       <span class="s1">'{"using": "css selector", "value": "cite"}'</span> <span class="se">\</span>
       | jq <span class="nt">-r</span> .value[].ELEMENT <span class="se">\</span>
  <span class="k">)</span> <span class="p">;</span> <span class="k">do
  </span>get <span class="s2">"/element/</span><span class="nv">$element_id</span><span class="s2">/text"</span> | jq <span class="nt">-r</span> .value
<span class="k">done</span>
</code></pre></div></div>

<p>I get the following output:</p>

<pre><code class="language-plain">www.seleniumhq.org/
www.seleniumhq.org/
www.webmd.com/a-to-z-guides/supplement-guide-selenium
https://en.wikipedia.org/wiki/Selenium
https://ods.od.nih.gov/factsheets/Selenium-HealthProfessional/
https://www.nrv.gov.au/nutrients/selenium
https://cosmosmagazine.com › Geoscience › Topics
www.whfoods.com/genpage.php?dbid=95&amp;tname=nutrient
selenium-python.readthedocs.io/
selenium-python.readthedocs.io/getting-started.html
https://seleniumhq.wordpress.com/
</code></pre>

<h2 id="further-reading">Further reading</h2>

<p>I’ve referred frequently to <a href="https://w3c.github.io/webdriver/webdriver-spec.html">the spec</a> in writing this.
In particular, the “List of Endpoints” and “Command Contexts” sections are useful.
At the time of writing you can search the page for those terms to get there quickly.</p>

<h2 id="builtin-methods">Builtin methods</h2>

<p>The list of supported actions (from <a href="https://w3c.github.io/webdriver/webdriver-spec.html">the spec</a>) are summarized below.</p>

<p>The spec makes for hard reading but each section is quite short.</p>

<ul>
  <li>New Session (<em>POST</em>) - Open a browser session. The only API not requiring a session ID</li>
  <li>Delete Session (<em>DELETE</em>) - Terminate a browser session</li>
  <li>Status (<em>GET</em>) - Describe a session</li>
  <li>Go (<em>POST</em>) - Navigate the current tab</li>
  <li>Get Current URL (<em>GET</em>)</li>
  <li>Back (<em>POST</em>)</li>
  <li>Forward (<em>POST</em>)</li>
  <li>Refresh (<em>POST</em>)</li>
  <li>Get Title (<em>GET</em>)</li>
  <li>Get Page Source (<em>GET</em>)</li>
  <li>Take Screenshot (<em>GET</em>) - Return a base64 encoded PNG of the page</li>
</ul>

<h3 id="element-interaction">Element interaction</h3>

<p>These APIs operate on element handles, which are opaque IDs
allocated by selenium when you find/get an element.</p>

<p>Use those IDs to interact with elements.</p>

<ul>
  <li>Find Element (<em>POST</em>)</li>
  <li>Find Element From Element (<em>POST</em>)</li>
  <li>Find Elements (<em>POST</em>)</li>
  <li>Find Elements From Element (<em>POST</em>)</li>
  <li>Get Active Element (<em>GET</em>)</li>
  <li>Is Element Selected (<em>GET</em>)</li>
  <li>Get Element Attribute (<em>GET</em>)</li>
  <li>Get Element Property (<em>GET</em>)</li>
  <li>Get Element CSS Value (<em>GET</em>)</li>
  <li>Get Element Text (<em>GET</em>)</li>
  <li>Get Element Tag Name (<em>GET</em>)</li>
  <li>Get Element Rect (<em>GET</em>) - get element position and size</li>
  <li>Is Element Enabled (<em>GET</em>) - only for form controls</li>
  <li>Element Click (<em>POST</em>)</li>
  <li>Element Clear (<em>POST</em>) - Empty text fields, unchecks checkboxes, etc</li>
  <li>Element Send Keys (<em>POST</em>) - Can be used to fill in forms, hit enter, etc.</li>
  <li>Take Element Screenshot (<em>GET</em>) - Return a base64 encoded PNG of the element</li>
</ul>

<h3 id="javascript">Javascript</h3>

<p>Inject arbitrary JS to run in the page.</p>

<ul>
  <li>Execute Script (<em>POST</em>) - Must be expressed as an inline function call - return value is serialized and sent back</li>
  <li>Execute Async Script (<em>POST</em>)</li>
</ul>

<h3 id="modals-alert-confirm-and-prompt">Modals: ‘alert’, ‘confirm’ and ‘prompt’</h3>
<ul>
  <li>Dismiss Alert (<em>POST</em>)</li>
  <li>Accept Alert (<em>POST</em>)</li>
  <li>Get Alert Text (<em>GET</em>)</li>
  <li>Send Alert Text (<em>POST</em>) - Fill in a prompt</li>
</ul>

<h3 id="cookies">Cookies</h3>

<ul>
  <li>Get All Cookies (<em>GET</em>)</li>
  <li>Get Named Cookie (<em>GET</em>)</li>
  <li>Add Cookie (<em>POST</em>)</li>
  <li>Delete Cookie (<em>DELETE</em>)</li>
  <li>Delete All Cookies (<em>DELETE</em>)</li>
</ul>

<h3 id="window-management">Window management</h3>

<p>Lets you open multiple tabs/windows in the same selenium session.</p>

<ul>
  <li>Get Window Handle (<em>GET</em>)</li>
  <li>Close Window (<em>DELETE</em>)</li>
  <li>Switch To Window (<em>POST</em>)</li>
  <li>Get Window Handles (<em>GET</em>)</li>
  <li>Fullscreen Window (<em>POST</em>)</li>
  <li>Maximize Window (<em>POST</em>)</li>
  <li>Set Window Size (<em>POST</em>)</li>
  <li>Get Window Position (<em>GET</em>)</li>
  <li>Set Window Position (<em>POST</em>)</li>
  <li>Get Window Size (<em>GET</em>)</li>
  <li>Switch To Frame (<em>POST</em>)</li>
  <li>Switch To Parent Frame (<em>POST</em>)</li>
</ul>

<h3 id="timeout-management">Timeout management</h3>

<p>Lets you define how long a page is allowed to spend loading html/scripts.</p>

<p>I haven’t had a reason to use them to date so can’t describe them in much more detail than that.</p>

<ul>
  <li>Get Timeouts (<em>GET</em>)</li>
  <li>Set Timeouts (<em>POST</em>)</li>
</ul>

<h3 id="action-api">Action API</h3>

<p>This API lets you script relatively advanced sequences of user behaviors - eg by describing the touch events that form a gesture.</p>

<p>I haven’t had a reason to use them to date so can’t describe them in much more detail than that.</p>

<ul>
  <li>Perform Actions (<em>POST</em>)</li>
  <li>Releasing Actions (<em>DELETE</em>)</li>
</ul>


	</div>
</article>




  
  <article class="post h-entry">
	<h1>
		<a class="p-name" href="/2014/08/27/postgres-features-in-20-minutes/">Postgres features for Ruby developers</a>
		<div class="byline">
			<span
				class="small post-date dt-published"
				datetime="2014-08-27 00-00-00"
			>Aug 27, 2014</span>
			<span class="small p-author author-byline h-card">Daniel Heath</span>
		</div>
	</h1>

	<div class="content e-content">
		<h2 id="about-postgres">About postgres</h2>

<p>Postgres is a relational database which is
widely used by Ruby developers.</p>

<p>For instance, it’s the default database for Heroku (a popular
hosting provider for Ruby apps).</p>

<p>Like most databases, postgres uses standard SQL.
It also offers many features which
are not available in most other databases.</p>

<p>I’m going to provide a high-level overview of features
here without providing much detail.
If you have questions, the <a href="http://www.postgresql.org/docs/current/static/sql.html">online documentation for postgres</a> is
comprehensive, useful, and up to date.</p>

<h2 id="overview-of-features">Overview of Features</h2>

<h3 id="uuid-columns">UUID columns</h3>

<p>By default, Rails gives you tables with an integer ID.
This ID is always generated when you create a new
record - you can’t specify the value for a new records ID.</p>

<p>Postgres supports using a Universally Unique ID (UUID) instead.</p>

<p>UUIDs look like this: <code class="highlighter-rouge">93743318-67f4-4c29-8ba0-5ba4f667c7b2</code>.</p>

<p>This can be a useful alternative because it lets you specify
the ID, but will still generate an ID if you don’t specify one.</p>

<h3 id="text-search">Text Search</h3>

<p>Some apps need fulltext search, but running a separate search engine
is hard. Postgres has a reasonably good quality text-search engine built in.</p>

<p>You’ll need to spend some time perusing the documentation to use this - every
app is different and you’ll need to configure the search to suit your needs.</p>

<h3 id="spatial-data">Spatial data</h3>

<p>One of the most commonly used extensions to postgres is called PostGIS.
This lets you store geographic data (e.g. points or areas on a map).</p>

<p>You can then write queries to find (e.g.) what’s
within 10km of this point, with the closest points first.</p>

<h3 id="scaling">Scaling</h3>

<p>Most web applications using postgres will have one server
dedicated to running postgres, with other servers running
the web application.</p>

<p>As the amount of data you’re dealing with increases,
the database server can become overloaded.</p>

<p>There are three common approaches to avoiding this:</p>

<h4 id="throw-money-at-it">Throw money at it</h4>

<p>The easiest answer is usually “buy more ram/CPU/disk”.</p>

<h4 id="partitioning-via-child-tables">Partitioning via Child Tables</h4>

<p>Partitioning lets you use multiple servers, storing part of your data on each of them.</p>

<p>This technique helps you scale a database which is overloaded
due to too many <code class="highlighter-rouge">update</code>, <code class="highlighter-rouge">delete</code> &amp; <code class="highlighter-rouge">insert</code> commands.</p>

<p>For instance, all records where the <code class="highlighter-rouge">name</code> field starts from A through F
will go to one server, G through P to a second, and the remainder to a third.</p>

<p>You can achieve this using a feature called child tables (the documentation has good examples).</p>

<h4 id="replication">Replication</h4>

<p>Replication lets you use multiple servers, storing all of your data on each of them.
Only one of the servers is allowed to handle <code class="highlighter-rouge">update</code>, <code class="highlighter-rouge">insert</code> or <code class="highlighter-rouge">delete</code> queries.</p>

<p>This technique helps you scale a database which is overloaded
due to too many <code class="highlighter-rouge">select</code> queries running at once.</p>

<p>It is also good because each server has a full copy of the database,
meaning that if the primary database fails, you can
quickly switch to one of the replica servers.</p>

<p>Most modern databases, including Postgres, have good
support for replication.</p>

<h3 id="arrays-and-hashes-and-json-oh-my-xml-too">Arrays and Hashes and JSON, oh my! (XML too)</h3>

<h4 id="arrays">Arrays</h4>

<p>A column in an SQL table has a type (e.g. string, integer, timestamp).
Postgres also lets you can create a column which stores an array of
strings, or timestamps, or any other type (even arrays of arrays!).</p>

<p>If you’re using Rails with ActiveRecord, these arrays
work like normal Ruby arrays.</p>

<h4 id="hashes-via-hstore">Hashes (via HSTORE)</h4>

<p>Similarly to arrays, you can store hashes like <code class="highlighter-rouge">{'foo' =&gt; 'bar', 'k' =&gt; 'v'}</code>
This works like a normal Ruby hash through ActiveRecord, except you can
only use strings for the keys and values.</p>

<h4 id="json">JSON</h4>

<p>Postgres has a JSON type which can store any JSON value.
ActiveRecord makes this work nicely with Ruby (with caveats;
it can’t tell that the JSON has changed when
you modify part of a nested structure).</p>

<p>You can query your JSON data using postgres built-in functions.</p>

<h4 id="xml">XML</h4>

<p>The XML type will stop you from accidentally storing something which
is not valid XML. This is better than just using a string field, as
you can be sure that the data you have stored is valid XML.</p>

<p>You can query your XML data using XPATH selectors.</p>

<h3 id="stored-procedures">Stored procedures</h3>

<p>Postgres lets you create stored procedures (functions written in SQL).</p>

<p>You can write these functions in other languages if you have the right
extensions installed; for instance, the V8 Postgres extension lets you
write stored procedures in Javascript. There is also a Ruby extension.</p>

<p>Writing stored procedures in Javascript is clearly a good idea which
will not upset your teammates.</p>

<h3 id="indexing">Indexing</h3>

<p>Big database tables can be hundreds of gigabytes, and it can take a long
time to scan through all that data to find the record you’re looking for.</p>

<p>An index is a much smaller file which can be scanned quickly and tells
the database where to find the records which match a query.</p>

<p>Practically all databases support some kind of indexing.</p>

<h4 id="partial-indexes">Partial indexes</h4>

<p>Unlike other databases, postgres lets you create an index with a
<code class="highlighter-rouge">where</code> condition (e.g. <code class="highlighter-rouge">create index (...) where (condition)</code>).</p>

<p>This means that the index file can be even smaller and quicker to use.</p>

<h4 id="expression-indexes">Expression indexes</h4>

<p>Postgres also allows you to create an index on any expression (not just a column).
This means you can do things like <code class="highlighter-rouge">create index index_name on table_name ( to_uppercase(description) )</code></p>

<h3 id="ddl-transactions">DDL Transactions</h3>

<p>This feature protects you when running migrations.</p>

<p>In other databases, if a migration fails part-way through, the database
can be left half-way between the old state and the new state. Postgres
stops this from happening - migrations either succeed completely, or
do nothing at all.</p>

<h3 id="constraints--deferred-constraints">Constraints &amp; Deferred constraints</h3>

<p>Many databases support constraints (like validations built into the database).</p>

<p>However, they are often hard to use because they can’t be broken, even temporarily.</p>

<p>Postgres supports <code class="highlighter-rouge">deferred</code> constraints, which only apply when you commit a transaction.
This makes constraints far more usable with Rails.</p>

<h3 id="foreign-tables">Foreign Tables</h3>

<p>Foreign tables let you run join queries against tables which are in
a totally different database (e.g. MySql or any JDBC database).</p>

<p>Handy when dealing with really big, organically grown systems.</p>

	</div>
</article>




  
  <article class="post h-entry">
	<h1>
		<a class="p-name" href="/2013/10/03/questions-for-prospective-employers/">Questions for prospective employers</a>
		<div class="byline">
			<span
				class="small post-date dt-published"
				datetime="2013-10-03 00-00-00"
			>Oct  3, 2013</span>
			<span class="small p-author author-byline h-card">Daniel Heath</span>
		</div>
	</h1>

	<div class="content e-content">
		<p>I’ve been jobhunting a bit recently. Below are a few of the questions I find give me a reasonable sense of what a company is about.</p>

<h2 id="corporate">Corporate</h2>

<p>How many large customers? How many small ones? How much variance in customer spend is there? (companies with few large customers are probably going to work on whatever those customers tell them to work on; if they have many small customers and don’t  A/B test something might be wrong)</p>

<p>Org chart: How many sales / dev / product / UX / admin?</p>

<p>Has the team released any interesting OSS in the last year (on work time)?</p>

<p>Has the team released any interesting OSS in the last year (on their own time)?</p>

<p>How much pairing do you do and when/why do you do it?</p>

<p>How/when do you do code reviews? During pairing?</p>

<h2 id="code">Code</h2>

<p>What’s your take on test coverage?</p>

<p>What quality metrics do you use?</p>

<p>Do you enforce a styleguide? How?</p>

<p>What languages &amp; frameworks do you use?</p>

<p>How long does a typical CI build take?
How long does a typical local build take?</p>

<p>What techniques do you use to keep tests running fast? (e.g. parallel tests, GC tweaks, avoiding I/O)</p>

<p>How many code repositories? apps?</p>

<h2 id="devops">Devops</h2>
<p>How similar is your development environment to production?</p>

<p>How many architectural pieces are there (appworker, queue, cache, database)?</p>

<p>How many of these are outsourced vs self run (e.g. are you using RDS/heroku PG, or running mysql/postgres yourselves? Do you run your own queue or use iron.io?)</p>

<p>How often do you deploy? Continuous delivery? Fortnightly sprints?</p>

<p>How many production-like environments do you have (eg staging, uat)?</p>

<p>How long from ‘lets deploy’ to ‘done’?</p>

<p>How long to roll-back from a bad deploy?</p>

<p>How many servers are you running?</p>

<p>How many kinds of server are you running (db, cache, web, ci, SCM hosting…)?</p>

<p>Cloud or self-hosted (or something else)?</p>

<h2 id="team--culture">Team &amp; Culture</h2>

<p>How is the team organised? Small groups? Heirarchy? Triads?
How do the dev team decide what to work on?
How do you stay in sync across multiple locations (if applicable)?
How do the team keep each other informed (eg email/chat/face-to-face)?</p>

<p>How often do you use A/B testing to determine whether a change stays? Who makes the call on what to test?</p>

<p>How do you set up a new development environment?</p>


	</div>
</article>





		<footer class="vcard">
			&copy; 2013
			<strong class="name fn">Daniel Heath</strong> |
			<a href="/about">About</a> |

			<address class="adr">
					<a class="email" href="mailto:daniel@heath.cc">Email</a> |
					<a href="http://daniel.heath.cc/">Blog</a> |
					<a href="https://github.com/DanielHeath">Github</a> |
					<a href="https://twitter.com/DanielrHeath">Twitter</a> |
					<a href="/resume">Resume</a> |
					<a href="https://plus.google.com/114859106574535166251">Google+</a> |
				<a class="url" href="xmpp:daniel@heath.cc">Jabber</a>
			</address>
		</footer>

		<link rel="stylesheet" href="/highlight/styles/solarized-dark.css">
		<script src="/highlight/highlight.pack.js"></script>
		<script>hljs.initHighlightingOnLoad();</script>

		<script type="text/javascript">
				var _gaq = _gaq || [];
				_gaq.push(['_setAccount', 'UA-38426219-1']);
				_gaq.push(['_setDomainName', 'heath.cc']);
				_gaq.push(['_trackPageview']);

				(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
				})();
		</script>

	</body>

</html>
